# MVP ëª¨ì˜ ê²°ì œ ì‹œìŠ¤í…œ êµ¬í˜„ ì›Œí¬í”Œë¡œìš°

## ğŸ¯ ê°œìš”

Coffee Assistant í”„ë¡œì íŠ¸ì˜ **MVP ë‹¨ê³„ ì£¼ë¬¸ ë° ê²°ì œ ì‹œìŠ¤í…œ** êµ¬í˜„ ê°€ì´ë“œì…ë‹ˆë‹¤. ì‹¤ì œ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ í†µí•© ì—†ì´ ì„±ê³µì ì¸ ê²°ì œë¥¼ ê°€ì •í•˜ê³  ì£¼ë¬¸ ë°ì´í„°ë§Œ ì €ì¥í•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.

**í•µì‹¬ ì „ëµ**: ë³µì¡í•œ ê²°ì œ í†µí•©ì„ í”¼í•˜ê³  í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ì‚¬ìš©ì í”Œë¡œìš°ë¥¼ ë¨¼ì € ê²€ì¦í•©ë‹ˆë‹¤.

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 6-8ì‹œê°„
**ë°ì´í„°ë² ì´ìŠ¤**: Supabase (ê¸°ì¡´ êµ¬ì¡° í™•ì¥)
**ê¸°ìˆ  ìŠ¤íƒ**: Next.js 16 App Router, React 19, Server Actions, TypeScript

---

## ğŸ“Š MVP ë²”ìœ„ ë° ì œì•½ì‚¬í•­

### âœ… í¬í•¨ë˜ëŠ” ê¸°ëŠ¥

1. **ì£¼ë¬¸ ìƒì„±**
   - ì¥ë°”êµ¬ë‹ˆì—ì„œ ì£¼ë¬¸ ìƒì„±
   - ì£¼ë¬¸ì ì •ë³´ ì…ë ¥ (ì´ë¦„, ì—°ë½ì²˜)
   - ì£¼ë¬¸ í•­ëª© ë° ì˜µì…˜ ì €ì¥

2. **ëª¨ì˜ ê²°ì œ ì²˜ë¦¬**
   - ê²°ì œ ë°©ë²• ì„ íƒ (ì‹ ìš©ì¹´ë“œ, ê°„í¸ê²°ì œ ë“±)
   - í•­ìƒ ì„±ê³µí•˜ëŠ” ê²°ì œ ì²˜ë¦¬
   - ê²°ì œ ì •ë³´ ì €ì¥ (ì‹¤ì œ ê²°ì œ ì—†ìŒ)

3. **ì£¼ë¬¸ ì¡°íšŒ**
   - ì£¼ë¬¸ ìƒì„¸ ì •ë³´ ì¡°íšŒ
   - ì‚¬ìš©ìë³„ ì£¼ë¬¸ ëª©ë¡
   - ì£¼ë¬¸ ìƒíƒœ ì¶”ì 

4. **ì£¼ë¬¸ ìƒíƒœ ê´€ë¦¬**
   - pending (ì£¼ë¬¸ ìƒì„±)
   - paid (ê²°ì œ ì™„ë£Œ)
   - confirmed (ì£¼ë¬¸ í™•ì¸)
   - completed (ì£¼ë¬¸ ì™„ë£Œ)

### âŒ í¬í•¨ë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ (í–¥í›„ í™•ì¥)

- ì‹¤ì œ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ ì—°ë™ (Stripe, Toss Payments ë“±)
- ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ (Supabase Auth)
- ì£¼ë¬¸ ì·¨ì†Œ ë° í™˜ë¶ˆ
- ì¬ê³  ê´€ë¦¬
- ë°°ì†¡ ì¶”ì 
- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ

---

## ğŸ—„ï¸ Phase 1: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### 1.1 ìƒˆë¡œìš´ í…Œì´ë¸” 3ê°œ ì¶”ê°€

#### orders í…Œì´ë¸” (ì£¼ë¬¸)

```sql
CREATE TABLE public.orders (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

  -- ì£¼ë¬¸ ë²ˆí˜¸ (ì‚¬ìš©ì ë…¸ì¶œìš©)
  order_number VARCHAR(50) UNIQUE NOT NULL,

  -- ì£¼ë¬¸ì ì •ë³´ (MVP: ì¸ì¦ ì—†ì´ ì…ë ¥ë°›ìŒ)
  customer_name VARCHAR(100) NOT NULL,
  customer_phone VARCHAR(20) NOT NULL,
  customer_email VARCHAR(255),

  -- ì£¼ë¬¸ ê¸ˆì•¡
  total_amount INTEGER NOT NULL,
  discount_amount INTEGER DEFAULT 0,
  final_amount INTEGER NOT NULL,

  -- ì£¼ë¬¸ ìƒíƒœ
  status VARCHAR(50) NOT NULL DEFAULT 'pending',
  -- pending: ì£¼ë¬¸ ìƒì„±
  -- paid: ê²°ì œ ì™„ë£Œ
  -- confirmed: ì£¼ë¬¸ í™•ì¸
  -- completed: ì™„ë£Œ
  -- cancelled: ì·¨ì†Œ

  -- ë©”ëª¨
  order_notes TEXT,

  -- íƒ€ì„ìŠ¤íƒ¬í”„
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
  confirmed_at TIMESTAMP WITH TIME ZONE,
  completed_at TIMESTAMP WITH TIME ZONE
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_orders_order_number ON public.orders(order_number);
CREATE INDEX idx_orders_customer_phone ON public.orders(customer_phone);
CREATE INDEX idx_orders_status ON public.orders(status);
CREATE INDEX idx_orders_created_at ON public.orders(created_at DESC);
```

#### order_items í…Œì´ë¸” (ì£¼ë¬¸ ìƒì„¸ í•­ëª©)

```sql
CREATE TABLE public.order_items (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

  -- ì£¼ë¬¸ FK
  order_id BIGINT NOT NULL REFERENCES public.orders(id) ON DELETE CASCADE,

  -- ë©”ë‰´ FK
  menu_id BIGINT NOT NULL REFERENCES public.menu(id),

  -- ì£¼ë¬¸ ë‹¹ì‹œ ë©”ë‰´ ì •ë³´ (ìŠ¤ëƒ…ìƒ·)
  menu_name VARCHAR(255) NOT NULL,
  menu_price INTEGER NOT NULL,

  -- ìˆ˜ëŸ‰ ë° ì˜µì…˜
  quantity INTEGER NOT NULL DEFAULT 1,
  temperature VARCHAR(10), -- 'hot' or 'cold'

  -- í•­ëª©ë³„ ê¸ˆì•¡
  item_price INTEGER NOT NULL,
  item_total INTEGER NOT NULL,

  -- íƒ€ì„ìŠ¤íƒ¬í”„
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_order_items_order_id ON public.order_items(order_id);
CREATE INDEX idx_order_items_menu_id ON public.order_items(menu_id);
```

#### payments í…Œì´ë¸” (ê²°ì œ ì •ë³´)

```sql
CREATE TABLE public.payments (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

  -- ì£¼ë¬¸ FK
  order_id BIGINT NOT NULL REFERENCES public.orders(id) ON DELETE CASCADE,

  -- ê²°ì œ ë°©ë²•
  payment_method VARCHAR(50) NOT NULL,
  -- 'card': ì‹ ìš©ì¹´ë“œ
  -- 'kakao': ì¹´ì¹´ì˜¤í˜ì´
  -- 'naver': ë„¤ì´ë²„í˜ì´
  -- 'cash': í˜„ì¥ê²°ì œ

  -- ê²°ì œ ê¸ˆì•¡
  amount INTEGER NOT NULL,

  -- ê²°ì œ ìƒíƒœ (MVP: í•­ìƒ 'success')
  status VARCHAR(50) NOT NULL DEFAULT 'success',
  -- success: ì„±ê³µ
  -- pending: ëŒ€ê¸°
  -- failed: ì‹¤íŒ¨

  -- ëª¨ì˜ ê²°ì œ ì •ë³´
  mock_transaction_id VARCHAR(100) NOT NULL,
  mock_approval_number VARCHAR(100),

  -- íƒ€ì„ìŠ¤íƒ¬í”„
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_payments_order_id ON public.payments(order_id);
CREATE INDEX idx_payments_status ON public.payments(status);
CREATE INDEX idx_payments_created_at ON public.payments(created_at DESC);
```

### 1.2 ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±

```bash
# ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
supabase migration new create_order_system

# íŒŒì¼ ê²½ë¡œ: supabase/migrations/20250002000000_create_order_system.sql
```

---

## âš™ï¸ Phase 2: Server Actions êµ¬í˜„

### 2.1 ì£¼ë¬¸ ìƒì„± Server Action

`src/app/actions/order.ts`:

```typescript
'use server'

import { revalidatePath } from 'next/cache'
import { redirect } from 'next/navigation'
import { supabase } from '@/lib/supabase'

// ì£¼ë¬¸ ìƒì„± ìš”ì²­ íƒ€ì…
export interface CreateOrderRequest {
  customerName: string
  customerPhone: string
  customerEmail?: string
  items: Array<{
    menuId: number
    menuName: string
    menuPrice: number
    quantity: number
    temperature?: 'hot' | 'cold'
  }>
  totalAmount: number
  discountAmount?: number
  orderNotes?: string
}

// ì£¼ë¬¸ ìƒì„± ì‘ë‹µ íƒ€ì…
export interface CreateOrderResponse {
  success: boolean
  orderId?: number
  orderNumber?: string
  error?: string
}

/**
 * ì£¼ë¬¸ ìƒì„± Server Action
 */
export async function createOrder(
  request: CreateOrderRequest
): Promise<CreateOrderResponse> {
  try {
    // 1. ì£¼ë¬¸ ë²ˆí˜¸ ìƒì„± (ì˜ˆ: ORD20250128001)
    const orderNumber = generateOrderNumber()

    // 2. ìµœì¢… ê¸ˆì•¡ ê³„ì‚°
    const finalAmount = request.totalAmount - (request.discountAmount || 0)

    // 3. orders í…Œì´ë¸”ì— ì£¼ë¬¸ ìƒì„±
    const { data: order, error: orderError } = await supabase
      .from('orders')
      .insert({
        order_number: orderNumber,
        customer_name: request.customerName,
        customer_phone: request.customerPhone,
        customer_email: request.customerEmail,
        total_amount: request.totalAmount,
        discount_amount: request.discountAmount || 0,
        final_amount: finalAmount,
        status: 'pending',
        order_notes: request.orderNotes,
      })
      .select()
      .single()

    if (orderError) {
      console.error('ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨:', orderError)
      return { success: false, error: 'ì£¼ë¬¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' }
    }

    // 4. order_items í…Œì´ë¸”ì— ì£¼ë¬¸ í•­ëª© ìƒì„±
    const orderItems = request.items.map(item => ({
      order_id: order.id,
      menu_id: item.menuId,
      menu_name: item.menuName,
      menu_price: item.menuPrice,
      quantity: item.quantity,
      temperature: item.temperature,
      item_price: item.menuPrice,
      item_total: item.menuPrice * item.quantity,
    }))

    const { error: itemsError } = await supabase
      .from('order_items')
      .insert(orderItems)

    if (itemsError) {
      console.error('ì£¼ë¬¸ í•­ëª© ìƒì„± ì‹¤íŒ¨:', itemsError)
      // ë¡¤ë°±: ì£¼ë¬¸ ì‚­ì œ
      await supabase.from('orders').delete().eq('id', order.id)
      return { success: false, error: 'ì£¼ë¬¸ í•­ëª© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' }
    }

    // 5. ìºì‹œ ë¬´íš¨í™”
    revalidatePath('/orders')

    return {
      success: true,
      orderId: order.id,
      orderNumber: order.order_number,
    }
  } catch (error) {
    console.error('ì£¼ë¬¸ ìƒì„± ì˜¤ë¥˜:', error)
    return { success: false, error: 'ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' }
  }
}

/**
 * ì£¼ë¬¸ ë²ˆí˜¸ ìƒì„± ìœ í‹¸ë¦¬í‹°
 */
function generateOrderNumber(): string {
  const now = new Date()
  const year = now.getFullYear()
  const month = String(now.getMonth() + 1).padStart(2, '0')
  const day = String(now.getDate()).padStart(2, '0')
  const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0')

  return `ORD${year}${month}${day}${random}`
}
```

### 2.2 ëª¨ì˜ ê²°ì œ ì²˜ë¦¬ Server Action

`src/app/actions/payment.ts`:

```typescript
'use server'

import { revalidatePath } from 'next/cache'
import { supabase } from '@/lib/supabase'

// ê²°ì œ ì²˜ë¦¬ ìš”ì²­ íƒ€ì…
export interface ProcessPaymentRequest {
  orderId: number
  paymentMethod: 'card' | 'kakao' | 'naver' | 'cash'
  amount: number
}

// ê²°ì œ ì²˜ë¦¬ ì‘ë‹µ íƒ€ì…
export interface ProcessPaymentResponse {
  success: boolean
  paymentId?: number
  transactionId?: string
  error?: string
}

/**
 * ëª¨ì˜ ê²°ì œ ì²˜ë¦¬ Server Action (í•­ìƒ ì„±ê³µ)
 */
export async function processPayment(
  request: ProcessPaymentRequest
): Promise<ProcessPaymentResponse> {
  try {
    // 1. ì£¼ë¬¸ ìƒíƒœ í™•ì¸
    const { data: order, error: orderError } = await supabase
      .from('orders')
      .select('*')
      .eq('id', request.orderId)
      .single()

    if (orderError || !order) {
      return { success: false, error: 'ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' }
    }

    if (order.status !== 'pending') {
      return { success: false, error: 'ì´ë¯¸ ì²˜ë¦¬ëœ ì£¼ë¬¸ì…ë‹ˆë‹¤.' }
    }

    // 2. ëª¨ì˜ íŠ¸ëœì­ì…˜ ID ìƒì„±
    const mockTransactionId = generateMockTransactionId()
    const mockApprovalNumber = generateMockApprovalNumber()

    // 3. payments í…Œì´ë¸”ì— ê²°ì œ ì •ë³´ ì €ì¥ (í•­ìƒ success)
    const { data: payment, error: paymentError } = await supabase
      .from('payments')
      .insert({
        order_id: request.orderId,
        payment_method: request.paymentMethod,
        amount: request.amount,
        status: 'success', // MVP: í•­ìƒ ì„±ê³µ
        mock_transaction_id: mockTransactionId,
        mock_approval_number: mockApprovalNumber,
      })
      .select()
      .single()

    if (paymentError) {
      console.error('ê²°ì œ ì •ë³´ ì €ì¥ ì‹¤íŒ¨:', paymentError)
      return { success: false, error: 'ê²°ì œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' }
    }

    // 4. ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ (pending â†’ paid)
    const { error: updateError } = await supabase
      .from('orders')
      .update({
        status: 'paid',
        updated_at: new Date().toISOString(),
      })
      .eq('id', request.orderId)

    if (updateError) {
      console.error('ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', updateError)
      return { success: false, error: 'ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' }
    }

    // 5. ìºì‹œ ë¬´íš¨í™”
    revalidatePath(`/orders/${request.orderId}`)
    revalidatePath('/orders')

    return {
      success: true,
      paymentId: payment.id,
      transactionId: mockTransactionId,
    }
  } catch (error) {
    console.error('ê²°ì œ ì²˜ë¦¬ ì˜¤ë¥˜:', error)
    return { success: false, error: 'ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' }
  }
}

/**
 * ëª¨ì˜ íŠ¸ëœì­ì…˜ ID ìƒì„±
 */
function generateMockTransactionId(): string {
  const timestamp = Date.now()
  const random = Math.floor(Math.random() * 100000)
  return `TXN${timestamp}${random}`
}

/**
 * ëª¨ì˜ ìŠ¹ì¸ ë²ˆí˜¸ ìƒì„±
 */
function generateMockApprovalNumber(): string {
  return Math.floor(Math.random() * 100000000).toString().padStart(8, '0')
}
```

### 2.3 ì£¼ë¬¸ ì¡°íšŒ Server Action

`src/app/actions/order.ts` (ì¶”ê°€):

```typescript
/**
 * ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ
 */
export async function getOrderById(orderId: number) {
  const { data: order, error: orderError } = await supabase
    .from('orders')
    .select(`
      *,
      order_items (*),
      payments (*)
    `)
    .eq('id', orderId)
    .single()

  if (orderError) {
    console.error('ì£¼ë¬¸ ì¡°íšŒ ì‹¤íŒ¨:', orderError)
    return null
  }

  return order
}

/**
 * ì—°ë½ì²˜ë¡œ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ
 */
export async function getOrdersByPhone(phone: string) {
  const { data: orders, error } = await supabase
    .from('orders')
    .select(`
      *,
      order_items (*),
      payments (*)
    `)
    .eq('customer_phone', phone)
    .order('created_at', { ascending: false })

  if (error) {
    console.error('ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error)
    return []
  }

  return orders
}
```

---

## ğŸ¨ Phase 3: í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

### 3.1 ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ ê´€ë¦¬

`src/hooks/useCart.ts`:

```typescript
'use client'

import { create } from 'zustand'
import { persist } from 'zustand/middleware'

export interface CartItem {
  menuId: number
  menuName: string
  menuPrice: number
  quantity: number
  temperature?: 'hot' | 'cold'
  image?: string
}

interface CartStore {
  items: CartItem[]
  addItem: (item: CartItem) => void
  removeItem: (menuId: number) => void
  updateQuantity: (menuId: number, quantity: number) => void
  clearCart: () => void
  getTotalAmount: () => number
  getTotalItems: () => number
}

export const useCart = create<CartStore>()(
  persist(
    (set, get) => ({
      items: [],

      addItem: (item) => {
        set((state) => {
          const existingItem = state.items.find(i => i.menuId === item.menuId)

          if (existingItem) {
            return {
              items: state.items.map(i =>
                i.menuId === item.menuId
                  ? { ...i, quantity: i.quantity + item.quantity }
                  : i
              ),
            }
          }

          return { items: [...state.items, item] }
        })
      },

      removeItem: (menuId) => {
        set((state) => ({
          items: state.items.filter(i => i.menuId !== menuId),
        }))
      },

      updateQuantity: (menuId, quantity) => {
        if (quantity <= 0) {
          get().removeItem(menuId)
          return
        }

        set((state) => ({
          items: state.items.map(i =>
            i.menuId === menuId ? { ...i, quantity } : i
          ),
        }))
      },

      clearCart: () => {
        set({ items: [] })
      },

      getTotalAmount: () => {
        return get().items.reduce(
          (total, item) => total + item.menuPrice * item.quantity,
          0
        )
      },

      getTotalItems: () => {
        return get().items.reduce((total, item) => total + item.quantity, 0)
      },
    }),
    {
      name: 'coffee-cart-storage',
    }
  )
)
```

### 3.2 ì£¼ë¬¸í•˜ê¸° í˜ì´ì§€

`src/app/checkout/page.tsx`:

```typescript
'use client'

import { useState, useTransition } from 'react'
import { useRouter } from 'next/navigation'
import { useCart } from '@/hooks/useCart'
import { createOrder } from '@/app/actions/order'
import { processPayment } from '@/app/actions/payment'
import { Button } from '@/components/ui/button'

export default function CheckoutPage() {
  const router = useRouter()
  const { items, getTotalAmount, clearCart } = useCart()
  const [isPending, startTransition] = useTransition()

  const [formData, setFormData] = useState({
    customerName: '',
    customerPhone: '',
    customerEmail: '',
    paymentMethod: 'card' as 'card' | 'kakao' | 'naver' | 'cash',
    orderNotes: '',
  })

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    startTransition(async () => {
      // 1. ì£¼ë¬¸ ìƒì„±
      const orderResult = await createOrder({
        customerName: formData.customerName,
        customerPhone: formData.customerPhone,
        customerEmail: formData.customerEmail,
        items: items.map(item => ({
          menuId: item.menuId,
          menuName: item.menuName,
          menuPrice: item.menuPrice,
          quantity: item.quantity,
          temperature: item.temperature,
        })),
        totalAmount: getTotalAmount(),
        orderNotes: formData.orderNotes,
      })

      if (!orderResult.success || !orderResult.orderId) {
        alert(orderResult.error || 'ì£¼ë¬¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
        return
      }

      // 2. ëª¨ì˜ ê²°ì œ ì²˜ë¦¬
      const paymentResult = await processPayment({
        orderId: orderResult.orderId,
        paymentMethod: formData.paymentMethod,
        amount: getTotalAmount(),
      })

      if (!paymentResult.success) {
        alert(paymentResult.error || 'ê²°ì œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
        return
      }

      // 3. ì¥ë°”êµ¬ë‹ˆ ì´ˆê¸°í™”
      clearCart()

      // 4. ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€ë¡œ ì´ë™
      router.push(`/orders/${orderResult.orderId}/complete`)
    })
  }

  if (items.length === 0) {
    return (
      <div className="container mx-auto px-4 py-8">
        <p className="text-center text-gray-500">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
      </div>
    )
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-2xl font-bold mb-6">ì£¼ë¬¸í•˜ê¸°</h1>

      <form onSubmit={handleSubmit} className="space-y-6">
        {/* ì£¼ë¬¸ì ì •ë³´ */}
        <section className="bg-white p-6 rounded-lg shadow">
          <h2 className="text-xl font-semibold mb-4">ì£¼ë¬¸ì ì •ë³´</h2>

          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-2">
                ì´ë¦„ *
              </label>
              <input
                type="text"
                required
                value={formData.customerName}
                onChange={(e) => setFormData({ ...formData, customerName: e.target.value })}
                className="w-full px-4 py-2 border rounded-lg"
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-2">
                ì—°ë½ì²˜ *
              </label>
              <input
                type="tel"
                required
                value={formData.customerPhone}
                onChange={(e) => setFormData({ ...formData, customerPhone: e.target.value })}
                className="w-full px-4 py-2 border rounded-lg"
                placeholder="010-1234-5678"
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-2">
                ì´ë©”ì¼ (ì„ íƒ)
              </label>
              <input
                type="email"
                value={formData.customerEmail}
                onChange={(e) => setFormData({ ...formData, customerEmail: e.target.value })}
                className="w-full px-4 py-2 border rounded-lg"
              />
            </div>
          </div>
        </section>

        {/* ì£¼ë¬¸ í•­ëª© */}
        <section className="bg-white p-6 rounded-lg shadow">
          <h2 className="text-xl font-semibold mb-4">ì£¼ë¬¸ í•­ëª©</h2>

          <div className="space-y-3">
            {items.map((item) => (
              <div key={item.menuId} className="flex justify-between items-center">
                <div>
                  <p className="font-medium">{item.menuName}</p>
                  <p className="text-sm text-gray-500">
                    {item.temperature && `${item.temperature === 'hot' ? 'HOT' : 'COLD'} | `}
                    ìˆ˜ëŸ‰: {item.quantity}ê°œ
                  </p>
                </div>
                <p className="font-semibold">
                  {(item.menuPrice * item.quantity).toLocaleString()}ì›
                </p>
              </div>
            ))}
          </div>

          <div className="mt-4 pt-4 border-t">
            <div className="flex justify-between items-center text-lg font-bold">
              <span>ì´ ê²°ì œ ê¸ˆì•¡</span>
              <span className="text-blue-600">
                {getTotalAmount().toLocaleString()}ì›
              </span>
            </div>
          </div>
        </section>

        {/* ê²°ì œ ë°©ë²• */}
        <section className="bg-white p-6 rounded-lg shadow">
          <h2 className="text-xl font-semibold mb-4">ê²°ì œ ë°©ë²•</h2>

          <div className="grid grid-cols-2 gap-4">
            {[
              { value: 'card', label: 'ì‹ ìš©ì¹´ë“œ' },
              { value: 'kakao', label: 'ì¹´ì¹´ì˜¤í˜ì´' },
              { value: 'naver', label: 'ë„¤ì´ë²„í˜ì´' },
              { value: 'cash', label: 'í˜„ì¥ê²°ì œ' },
            ].map((method) => (
              <label
                key={method.value}
                className={`
                  flex items-center justify-center p-4 border-2 rounded-lg cursor-pointer
                  ${formData.paymentMethod === method.value
                    ? 'border-blue-600 bg-blue-50'
                    : 'border-gray-300'
                  }
                `}
              >
                <input
                  type="radio"
                  name="paymentMethod"
                  value={method.value}
                  checked={formData.paymentMethod === method.value}
                  onChange={(e) => setFormData({ ...formData, paymentMethod: e.target.value as any })}
                  className="mr-2"
                />
                {method.label}
              </label>
            ))}
          </div>
        </section>

        {/* ìš”ì²­ì‚¬í•­ */}
        <section className="bg-white p-6 rounded-lg shadow">
          <h2 className="text-xl font-semibold mb-4">ìš”ì²­ì‚¬í•­</h2>

          <textarea
            value={formData.orderNotes}
            onChange={(e) => setFormData({ ...formData, orderNotes: e.target.value })}
            className="w-full px-4 py-2 border rounded-lg"
            rows={3}
            placeholder="ê°€ê²Œì— ì „ë‹¬í•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
          />
        </section>

        {/* ì£¼ë¬¸í•˜ê¸° ë²„íŠ¼ */}
        <Button
          type="submit"
          disabled={isPending}
          className="w-full py-4 text-lg font-semibold"
        >
          {isPending ? 'ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘...' : `${getTotalAmount().toLocaleString()}ì› ê²°ì œí•˜ê¸°`}
        </Button>
      </form>
    </div>
  )
}
```

### 3.3 ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€

`src/app/orders/[id]/complete/page.tsx`:

```typescript
import { notFound } from 'next/navigation'
import { getOrderById } from '@/app/actions/order'
import Link from 'next/link'
import { Button } from '@/components/ui/button'

export default async function OrderCompletePage({
  params,
}: {
  params: { id: string }
}) {
  const order = await getOrderById(Number(params.id))

  if (!order) {
    notFound()
  }

  const payment = order.payments?.[0]

  return (
    <div className="container mx-auto px-4 py-8">
      <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
        {/* ì„±ê³µ ì•„ì´ì½˜ */}
        <div className="text-center mb-6">
          <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg className="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <h1 className="text-2xl font-bold text-gray-900">ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h1>
          <p className="text-gray-600 mt-2">ì£¼ë¬¸ë²ˆí˜¸: {order.order_number}</p>
        </div>

        {/* ì£¼ë¬¸ ì •ë³´ */}
        <div className="border-t border-b py-6 space-y-4">
          <div>
            <h2 className="text-sm font-medium text-gray-500 mb-1">ì£¼ë¬¸ì ì •ë³´</h2>
            <p className="text-gray-900">{order.customer_name}</p>
            <p className="text-gray-600">{order.customer_phone}</p>
          </div>

          <div>
            <h2 className="text-sm font-medium text-gray-500 mb-1">ì£¼ë¬¸ í•­ëª©</h2>
            <div className="space-y-2">
              {order.order_items.map((item: any) => (
                <div key={item.id} className="flex justify-between">
                  <span className="text-gray-900">
                    {item.menu_name} x {item.quantity}
                  </span>
                  <span className="text-gray-900">
                    {item.item_total.toLocaleString()}ì›
                  </span>
                </div>
              ))}
            </div>
          </div>

          {payment && (
            <div>
              <h2 className="text-sm font-medium text-gray-500 mb-1">ê²°ì œ ì •ë³´</h2>
              <p className="text-gray-900">
                ê²°ì œ ë°©ë²•: {getPaymentMethodLabel(payment.payment_method)}
              </p>
              <p className="text-gray-600 text-sm">
                ê±°ë˜ë²ˆí˜¸: {payment.mock_transaction_id}
              </p>
            </div>
          )}

          <div className="pt-4 border-t">
            <div className="flex justify-between items-center text-lg font-bold">
              <span>ì´ ê²°ì œ ê¸ˆì•¡</span>
              <span className="text-blue-600">
                {order.final_amount.toLocaleString()}ì›
              </span>
            </div>
          </div>
        </div>

        {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
        <div className="mt-6 p-4 bg-blue-50 rounded-lg">
          <p className="text-sm text-blue-900">
            ì£¼ë¬¸í•˜ì‹  ìŒë£ŒëŠ” ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤. ì—°ë½ì²˜ë¡œ SMSê°€ ë°œì†¡ë  ì˜ˆì •ì…ë‹ˆë‹¤.
          </p>
        </div>

        {/* ì•¡ì…˜ ë²„íŠ¼ */}
        <div className="mt-6 space-y-3">
          <Link href={`/orders/${order.id}`} className="block">
            <Button variant="outline" className="w-full">
              ì£¼ë¬¸ ìƒì„¸ ë³´ê¸°
            </Button>
          </Link>
          <Link href="/" className="block">
            <Button className="w-full">
              í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </Button>
          </Link>
        </div>
      </div>
    </div>
  )
}

function getPaymentMethodLabel(method: string): string {
  const labels: Record<string, string> = {
    card: 'ì‹ ìš©ì¹´ë“œ',
    kakao: 'ì¹´ì¹´ì˜¤í˜ì´',
    naver: 'ë„¤ì´ë²„í˜ì´',
    cash: 'í˜„ì¥ê²°ì œ',
  }
  return labels[method] || method
}
```

---

## ğŸ“‹ Phase 4: êµ¬í˜„ ìˆœì„œ

### 4.1 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (1ì‹œê°„)

```bash
# 1. ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
supabase migration new create_order_system

# 2. SQL ì‘ì„± (ìœ„ì˜ ìŠ¤í‚¤ë§ˆ ë³µì‚¬)

# 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
supabase db reset  # ë¡œì»¬
# ë˜ëŠ”
supabase db push   # í”„ë¡œë•ì…˜

# 4. TypeScript íƒ€ì… ìƒì„±
supabase gen types typescript --local > src/types/database.types.ts
```

### 4.2 Server Actions êµ¬í˜„ (2ì‹œê°„)

1. `src/app/actions/order.ts` ìƒì„±
2. `src/app/actions/payment.ts` ìƒì„±
3. Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì • í™•ì¸
4. íƒ€ì… ì •ì˜ ì¶”ê°€

### 4.3 ìƒíƒœ ê´€ë¦¬ êµ¬í˜„ (1ì‹œê°„)

1. Zustand ì„¤ì¹˜: `pnpm add zustand`
2. `src/hooks/useCart.ts` ìƒì„±
3. localStorage ì—°ë™ (persist ë¯¸ë“¤ì›¨ì–´)

### 4.4 í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ (2-3ì‹œê°„)

1. ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ (`/cart`)
2. ì£¼ë¬¸í•˜ê¸° í˜ì´ì§€ (`/checkout`)
3. ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€ (`/orders/[id]/complete`)
4. ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€ (`/orders/[id]`)
5. ë‚´ ì£¼ë¬¸ ëª©ë¡ í˜ì´ì§€ (`/orders`)

### 4.5 í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (1ì‹œê°„)

1. ì£¼ë¬¸ ìƒì„± í”Œë¡œìš° í…ŒìŠ¤íŠ¸
2. ê²°ì œ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
3. ì£¼ë¬¸ ì¡°íšŒ í…ŒìŠ¤íŠ¸
4. ì—ëŸ¬ í•¸ë“¤ë§ í…ŒìŠ¤íŠ¸

---

## âœ… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°ì´í„°ë² ì´ìŠ¤

- [ ] `orders` í…Œì´ë¸” ìƒì„± í™•ì¸
- [ ] `order_items` í…Œì´ë¸” ìƒì„± í™•ì¸
- [ ] `payments` í…Œì´ë¸” ìƒì„± í™•ì¸
- [ ] ì¸ë±ìŠ¤ ìƒì„± í™•ì¸
- [ ] FK ì œì•½ì¡°ê±´ í™•ì¸

### ë°±ì—”ë“œ (Server Actions)

- [ ] ì£¼ë¬¸ ìƒì„± ë™ì‘ í™•ì¸
- [ ] ì£¼ë¬¸ ë²ˆí˜¸ ìƒì„± í™•ì¸
- [ ] ì£¼ë¬¸ í•­ëª© ì €ì¥ í™•ì¸
- [ ] ëª¨ì˜ ê²°ì œ ì²˜ë¦¬ í™•ì¸ (í•­ìƒ ì„±ê³µ)
- [ ] ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ í™•ì¸
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ í™•ì¸

### í”„ë¡ íŠ¸ì—”ë“œ

- [ ] ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€/ì‚­ì œ ë™ì‘
- [ ] ì¥ë°”êµ¬ë‹ˆ localStorage ì €ì¥
- [ ] ì£¼ë¬¸í•˜ê¸° í¼ ê²€ì¦
- [ ] ê²°ì œ ë°©ë²• ì„ íƒ
- [ ] ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€ í‘œì‹œ
- [ ] ì£¼ë¬¸ ì¡°íšŒ ê¸°ëŠ¥

### ì‚¬ìš©ì í”Œë¡œìš°

- [ ] ë©”ë‰´ ì„ íƒ â†’ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€
- [ ] ì¥ë°”êµ¬ë‹ˆ â†’ ì£¼ë¬¸í•˜ê¸°
- [ ] ì£¼ë¬¸ì ì •ë³´ ì…ë ¥
- [ ] ê²°ì œ ë°©ë²• ì„ íƒ
- [ ] ì£¼ë¬¸ ìƒì„± ë° ê²°ì œ ì²˜ë¦¬
- [ ] ì£¼ë¬¸ ì™„ë£Œ í™•ì¸
- [ ] ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ

---

## ğŸ¯ ì˜ˆìƒ ê²°ê³¼ë¬¼

### 1. ë°ì´í„°ë² ì´ìŠ¤

- 3ê°œ ìƒˆ í…Œì´ë¸” (orders, order_items, payments)
- ì ì ˆí•œ ì¸ë±ìŠ¤ ë° FK ì œì•½ì¡°ê±´
- ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼

### 2. ë°±ì—”ë“œ

- `createOrder()` Server Action
- `processPayment()` Server Action
- `getOrderById()` Server Action
- `getOrdersByPhone()` Server Action

### 3. í”„ë¡ íŠ¸ì—”ë“œ

- ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ ê´€ë¦¬ í›… (`useCart`)
- ì£¼ë¬¸í•˜ê¸° í˜ì´ì§€ (`/checkout`)
- ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€ (`/orders/[id]/complete`)
- ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€ (`/orders/[id]`)
- ë‚´ ì£¼ë¬¸ ëª©ë¡ í˜ì´ì§€ (`/orders`)

---

## ğŸ’¡ MVP ì´í›„ í™•ì¥ ê³„íš

### Phase 2: ì‹¤ì œ ê²°ì œ ì—°ë™

- Stripe, Toss Payments ë“± ì‹¤ì œ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ ì—°ë™
- ì›¹í›…ì„ í†µí•œ ê²°ì œ ìƒíƒœ ë™ê¸°í™”
- ê²°ì œ ì‹¤íŒ¨ ì²˜ë¦¬ ë° ì¬ì‹œë„

### Phase 3: ì‚¬ìš©ì ì¸ì¦

- Supabase Auth ì—°ë™
- íšŒì› ì£¼ë¬¸ ê´€ë¦¬
- í¬ì¸íŠ¸ ì ë¦½ ë° ì‚¬ìš©

### Phase 4: ê³ ê¸‰ ê¸°ëŠ¥

- ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ
- ì£¼ë¬¸ ì·¨ì†Œ ë° í™˜ë¶ˆ
- ì•Œë¦¼ ì‹œìŠ¤í…œ (SMS, í‘¸ì‹œ)
- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [Next.js Server Actions ê³µì‹ ë¬¸ì„œ](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations)
- [Supabase JavaScript í´ë¼ì´ì–¸íŠ¸](https://supabase.com/docs/reference/javascript/introduction)
- [Zustand ìƒíƒœ ê´€ë¦¬](https://github.com/pmndrs/zustand)
- [React 19 use Hook](https://react.dev/reference/react/use)

---

**ì‘ì„±ì¼**: 2025-10-28
**ë²„ì „**: 1.0
**ìƒíƒœ**: MVP êµ¬í˜„ ì¤€ë¹„ ì™„ë£Œ
