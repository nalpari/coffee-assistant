# Phase 4 êµ¬í˜„ ì™„ë£Œ ê°€ì´ë“œ

## âœ… êµ¬í˜„ ì™„ë£Œ í•­ëª©

Phase 4ì˜ MVP ëª¨ì˜ ê²°ì œ ì‹œìŠ¤í…œ êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!

### 1. ë°ì´í„°ë² ì´ìŠ¤ (ì™„ë£Œ âœ…)

**ìƒì„±ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼:**
- `supabase/migrations/20250002000000_create_order_system.sql`

**ìƒˆë¡œ ì¶”ê°€ëœ í…Œì´ë¸”:**
- `orders`: ì£¼ë¬¸ ì •ë³´
- `order_items`: ì£¼ë¬¸ ìƒì„¸ í•­ëª©
- `payments`: ëª¨ì˜ ê²°ì œ ì •ë³´

### 2. Server Actions (ì™„ë£Œ âœ…)

**ìƒì„±ëœ íŒŒì¼:**
- `src/lib/supabase.ts`: Supabase í´ë¼ì´ì–¸íŠ¸
- `src/app/actions/order.ts`: ì£¼ë¬¸ ìƒì„± ë° ì¡°íšŒ
- `src/app/actions/payment.ts`: ëª¨ì˜ ê²°ì œ ì²˜ë¦¬

**êµ¬í˜„ëœ ì£¼ìš” í•¨ìˆ˜:**
- `createOrder()`: ì£¼ë¬¸ ìƒì„±
- `processPayment()`: ëª¨ì˜ ê²°ì œ ì²˜ë¦¬ (í•­ìƒ ì„±ê³µ)
- `getOrderById()`: ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ
- `getOrdersByPhone()`: ì—°ë½ì²˜ë¡œ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ

### 3. ìƒíƒœ ê´€ë¦¬ (ì™„ë£Œ âœ…)

**ìƒì„±ëœ íŒŒì¼:**
- `src/hooks/useCart.ts`: Zustand ê¸°ë°˜ ì¥ë°”êµ¬ë‹ˆ ê´€ë¦¬

**ì£¼ìš” ê¸°ëŠ¥:**
- ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€/ì‚­ì œ/ìˆ˜ëŸ‰ ë³€ê²½
- localStorage ìë™ ì €ì¥
- ì´ ê¸ˆì•¡ ê³„ì‚°

### 4. í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ (ì™„ë£Œ âœ…)

**ìƒì„±ëœ íŒŒì¼:**
- `src/app/checkout/page.tsx`: ì£¼ë¬¸í•˜ê¸° í˜ì´ì§€
- `src/app/orders/[id]/complete/page.tsx`: ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€

**ì£¼ìš” ê¸°ëŠ¥:**
- ì£¼ë¬¸ì ì •ë³´ ì…ë ¥
- ê²°ì œ ë°©ë²• ì„ íƒ
- ì£¼ë¬¸ í•­ëª© í™•ì¸
- ì£¼ë¬¸ ì™„ë£Œ ì•ˆë‚´

### 5. ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ (ì™„ë£Œ âœ…)

```json
{
  "zustand": "^5.0.2",
  "@supabase/supabase-js": "^2.48.1"
}
```

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„: ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

### 1ë‹¨ê³„: Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

#### ì˜µì…˜ A: ë¡œì»¬ ê°œë°œ í™˜ê²½ (ê¶Œì¥)

```bash
# 1. ë¡œì»¬ Supabase ì‹œì‘ (Docker í•„ìš”)
supabase start

# 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
supabase db reset

# 3. ë¡œì»¬ Studio ì ‘ì†í•˜ì—¬ í…Œì´ë¸” í™•ì¸
# http://localhost:54323
```

#### ì˜µì…˜ B: í”„ë¡œë•ì…˜ í™˜ê²½ (Supabase Cloud)

```bash
# í”„ë¡œë•ì…˜ DBì— ì§ì ‘ ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
supabase db push
```

### 2ë‹¨ê³„: TypeScript íƒ€ì… ìƒì„±

```bash
# ë¡œì»¬ í™˜ê²½
supabase gen types typescript --local > src/types/database.types.ts

# ë˜ëŠ” í”„ë¡œë•ì…˜ í™˜ê²½
supabase gen types typescript --project-id <YOUR_PROJECT_REF> > src/types/database.types.ts
```

### 3ë‹¨ê³„: ê°œë°œ ì„œë²„ ì¬ì‹œì‘

í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ê°œë°œ ì„œë²„ë“¤ì„ ì¢…ë£Œí•˜ê³  ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤:

```bash
# 1. í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì„œë²„ ì¢…ë£Œ (Ctrl+C)

# 2. ê°œë°œ ì„œë²„ ì¬ì‹œì‘
pnpm dev
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°ì´í„°ë² ì´ìŠ¤ ê²€ì¦

#### Supabase Dashboardì—ì„œ í™•ì¸:

1. **Table Editor** ë©”ë‰´ ì´ë™
   - [ ] `orders` í…Œì´ë¸” ì¡´ì¬ í™•ì¸
   - [ ] `order_items` í…Œì´ë¸” ì¡´ì¬ í™•ì¸
   - [ ] `payments` í…Œì´ë¸” ì¡´ì¬ í™•ì¸

2. **í…Œì´ë¸” êµ¬ì¡° í™•ì¸**
   ```sql
   -- orders í…Œì´ë¸” í™•ì¸
   SELECT * FROM public.orders LIMIT 1;

   -- order_items í…Œì´ë¸” í™•ì¸
   SELECT * FROM public.order_items LIMIT 1;

   -- payments í…Œì´ë¸” í™•ì¸
   SELECT * FROM public.payments LIMIT 1;
   ```

3. **ì¸ë±ìŠ¤ í™•ì¸**
   ```sql
   SELECT tablename, indexname
   FROM pg_indexes
   WHERE schemaname = 'public'
   AND tablename IN ('orders', 'order_items', 'payments');
   ```

### í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ í”Œë¡œìš°

#### ì „ì²´ ì£¼ë¬¸ í”„ë¡œì„¸ìŠ¤ í…ŒìŠ¤íŠ¸:

1. **ë©”ë‰´ í˜ì´ì§€** (êµ¬í˜„ í•„ìš”)
   - [ ] ë©”ë‰´ ëª©ë¡ í‘œì‹œ
   - [ ] ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ë²„íŠ¼

2. **ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€** (êµ¬í˜„ í•„ìš”)
   - [ ] ì¥ë°”êµ¬ë‹ˆ í•­ëª© í‘œì‹œ
   - [ ] ìˆ˜ëŸ‰ ë³€ê²½ ê¸°ëŠ¥
   - [ ] í•­ëª© ì‚­ì œ ê¸°ëŠ¥
   - [ ] ì´ ê¸ˆì•¡ ê³„ì‚°

3. **ì£¼ë¬¸í•˜ê¸° í˜ì´ì§€** (`/checkout`)
   - [ ] http://localhost:3000/checkout ì ‘ì†
   - [ ] ì£¼ë¬¸ì ì •ë³´ ì…ë ¥ í¼
   - [ ] ì£¼ë¬¸ í•­ëª© í‘œì‹œ
   - [ ] ê²°ì œ ë°©ë²• ì„ íƒ
   - [ ] ìš”ì²­ì‚¬í•­ ì…ë ¥
   - [ ] "ê²°ì œí•˜ê¸°" ë²„íŠ¼ í´ë¦­

4. **ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€** (`/orders/[id]/complete`)
   - [ ] ì£¼ë¬¸ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
   - [ ] ì£¼ë¬¸ ë²ˆí˜¸ í‘œì‹œ
   - [ ] ì£¼ë¬¸ ìƒì„¸ ì •ë³´ í‘œì‹œ
   - [ ] ê²°ì œ ì •ë³´ í‘œì‹œ

### Server Actions í…ŒìŠ¤íŠ¸

#### ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì§ì ‘ í…ŒìŠ¤íŠ¸:

```javascript
// 1. ì£¼ë¬¸ ìƒì„± í…ŒìŠ¤íŠ¸
const orderResult = await fetch('/api/orders', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    customerName: 'í™ê¸¸ë™',
    customerPhone: '010-1234-5678',
    items: [
      {
        menuId: 1,
        menuName: 'ì•„ë©”ë¦¬ì¹´ë…¸',
        menuPrice: 4500,
        quantity: 2,
        temperature: 'hot'
      }
    ],
    totalAmount: 9000
  })
});
console.log(await orderResult.json());

// 2. ê²°ì œ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ (ì£¼ë¬¸ ID í•„ìš”)
const paymentResult = await fetch('/api/payments', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    orderId: 1, // ìƒì„±ëœ ì£¼ë¬¸ ID
    paymentMethod: 'card',
    amount: 9000
  })
});
console.log(await paymentResult.json());
```

---

## ğŸ“‹ ë‹¤ìŒ êµ¬í˜„ í•­ëª© (Phase 5)

Phase 4 í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ë©´ ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤:

### 1. ë©”ë‰´ í˜ì´ì§€ ê°œì„ 
- [ ] ë©”ë‰´ ì¹´ë“œì— "ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°" ë²„íŠ¼ ì¶”ê°€
- [ ] ì˜¨ë„ ì„ íƒ ëª¨ë‹¬ (HOT/COLD)
- [ ] ìˆ˜ëŸ‰ ì„ íƒ ê¸°ëŠ¥

### 2. ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ ìƒì„±
- [ ] `/cart` í˜ì´ì§€ ìƒì„±
- [ ] ì¥ë°”êµ¬ë‹ˆ í•­ëª© ëª©ë¡ í‘œì‹œ
- [ ] ìˆ˜ëŸ‰ ë³€ê²½ UI
- [ ] í•­ëª© ì‚­ì œ ë²„íŠ¼
- [ ] "ì£¼ë¬¸í•˜ê¸°" ë²„íŠ¼ (â†’ `/checkout`)

### 3. ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€
- [ ] `/orders/[id]` í˜ì´ì§€ ìƒì„±
- [ ] ì£¼ë¬¸ ìƒì„¸ ì •ë³´ í‘œì‹œ
- [ ] ì£¼ë¬¸ ìƒíƒœ ì¶”ì 

### 4. ë‚´ ì£¼ë¬¸ ëª©ë¡ í˜ì´ì§€
- [ ] `/orders` í˜ì´ì§€ ìƒì„±
- [ ] ì—°ë½ì²˜ë¡œ ì£¼ë¬¸ ì¡°íšŒ
- [ ] ì£¼ë¬¸ ëª©ë¡ í‘œì‹œ

---

## ğŸ¯ í˜„ì¬ êµ¬í˜„ ìƒíƒœ

```
âœ… Phase 1: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„ (ì™„ë£Œ)
âœ… Phase 2: Server Actions êµ¬í˜„ (ì™„ë£Œ)
âœ… Phase 3: ìƒíƒœ ê´€ë¦¬ êµ¬í˜„ (ì™„ë£Œ)
âœ… Phase 4: í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ êµ¬í˜„ (ì™„ë£Œ)
â­ï¸ Phase 5: í†µí•© í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (ë‹¤ìŒ)
â­ï¸ Phase 6: ì¶”ê°€ í˜ì´ì§€ êµ¬í˜„ (ëŒ€ê¸°)
```

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨

**ì¦ìƒ**: `supabase db push` ì‹¤í–‰ ì‹œ ì˜¤ë¥˜ ë°œìƒ

**í•´ê²°ë°©ë²•**:
```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
supabase migration list

# ë¡œì»¬ DB ì¬ì„¤ì •
supabase db reset
```

### ë¬¸ì œ 2: íƒ€ì… ì˜¤ë¥˜

**ì¦ìƒ**: TypeScript íƒ€ì… ë¶ˆì¼ì¹˜ ì˜¤ë¥˜

**í•´ê²°ë°©ë²•**:
```bash
# íƒ€ì… ì¬ìƒì„±
supabase gen types typescript --local > src/types/database.types.ts

# í”„ë¡œì íŠ¸ ì¬ë¹Œë“œ
pnpm build
```

### ë¬¸ì œ 3: Zustand hydration ì˜¤ë¥˜

**ì¦ìƒ**: í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ë¶ˆì¼ì¹˜ ì˜¤ë¥˜

**í•´ê²°ë°©ë²•**:
- `useCart.ts`ì—ì„œ `skipHydration: true` ì„¤ì • í™•ì¸
- ì»´í¬ë„ŒíŠ¸ì—ì„œ `mounted` ìƒíƒœ ì‚¬ìš©

### ë¬¸ì œ 4: Supabase ì—°ê²° ì˜¤ë¥˜

**ì¦ìƒ**: `NEXT_PUBLIC_SUPABASE_URL` undefined

**í•´ê²°ë°©ë²•**:
```bash
# .env.local íŒŒì¼ í™•ì¸
cat .env.local | grep SUPABASE

# ê°œë°œ ì„œë²„ ì¬ì‹œì‘
pnpm dev
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [MVP ëª¨ì˜ ê²°ì œ ì‹œìŠ¤í…œ ì›Œí¬í”Œë¡œìš°](./MVP_PAYMENT_WORKFLOW.md)
- [Supabase ì„¤ì • ê°€ì´ë“œ](./SUPABASE_SETUP.md)
- [ë°ì´í„°ë² ì´ìŠ¤ ì›Œí¬í”Œë¡œìš°](./DATABASE_WORKFLOW.md)

---

**ì‘ì„±ì¼**: 2025-10-28
**ìƒíƒœ**: Phase 4 êµ¬í˜„ ì™„ë£Œ
**ë‹¤ìŒ ë‹¨ê³„**: ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ë° í†µí•© í…ŒìŠ¤íŠ¸
