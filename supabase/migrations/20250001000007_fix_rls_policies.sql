-- =====================================================
-- RLS 정책 수정 - status 값 불일치 해결
-- =====================================================
-- 문제: RLS 정책이 'MENU_STATUS_ACTIVE' 형식을 사용하지만
--       실제 데이터는 'E0101' 형식의 common_code ID를 사용
-- 해결: RLS 정책을 실제 데이터 형식에 맞게 수정
-- =====================================================

-- 기존 정책 삭제
DROP POLICY IF EXISTS "카테고리 읽기 허용" ON public.category;
DROP POLICY IF EXISTS "메뉴 읽기 허용" ON public.menu;

-- =====================================================
-- 카테고리 테이블 정책 (수정)
-- =====================================================

-- 읽기: 모든 사용자 허용 (활성 카테고리만)
-- status = 'D0101' (CATEGORY_ACTIVE)
CREATE POLICY "카테고리 읽기 허용"
ON public.category
FOR SELECT
TO public
USING (status = 'D0101');

-- =====================================================
-- 메뉴 테이블 정책 (수정)
-- =====================================================

-- 읽기: 모든 사용자 허용 (판매 가능한 메뉴만)
-- status = 'E0101' (MENU_ACTIVE) 또는 'E0102' (MENU_INACTIVE)도 허용 가능
CREATE POLICY "메뉴 읽기 허용"
ON public.menu
FOR SELECT
TO public
USING (
  status IN ('E0101', 'E0102')
  -- E0101: 사용 (MENU_ACTIVE)
  -- E0102: 미사용 (MENU_INACTIVE) - 필요시 제외 가능
);

-- =====================================================
-- 참고사항
-- =====================================================
-- common_code 테이블의 ID 값:
-- - D0101: 카테고리 활성 (CATEGORY_ACTIVE)
-- - D0102: 카테고리 비활성 (CATEGORY_INACTIVE)
-- - E0101: 메뉴 사용 (MENU_ACTIVE)
-- - E0102: 메뉴 미사용 (MENU_INACTIVE)
